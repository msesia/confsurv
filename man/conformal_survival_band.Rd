% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/csb_core.R
\name{conformal_survival_band}
\alias{conformal_survival_band}
\title{Construct Conformal Survival Bands}
\usage{
conformal_survival_band(
  data.test,
  data.cal,
  surv_model,
  cens_model,
  time_points = NULL,
  num_time_points = 100,
  doubly_robust = TRUE,
  fast = TRUE
)
}
\arguments{
\item{data.test}{A data frame of test data. Must include \code{time} and \code{status} columns.}

\item{data.cal}{A data frame of calibration data (also with \code{time} and \code{status} columns).}

\item{surv_model}{A fitted survival model object (e.g., created by \code{GRF_SurvivalForestWrapper$new()}).}

\item{cens_model}{A fitted censoring model object (same interface as \code{surv_model}, but fit to censored data).}

\item{time_points}{Optional numeric vector of time points at which to compute the bands. If \code{NULL}, a regular grid is used.}

\item{num_time_points}{Integer specifying number of time points to use if \code{time_points} is \code{NULL}. Default is 100.}

\item{doubly_robust}{Logical. If \code{TRUE}, the bands are extended to include the fitted model predictions (default: \code{TRUE}).}

\item{fast}{Logical. Whether to use fast, vectorized approximations for score and weight computations. Recommended. Default is \code{TRUE}.}
}
\value{
A list with the following components:
\describe{
\item{lower}{A matrix of lower survival bounds (patients Ã— time points).}
\item{upper}{A matrix of upper survival bounds.}
\item{time_points}{The time grid used.}
\item{model_pred}{Matrix of fitted survival probabilities from the black-box model.}
}
}
\description{
Computes marginal conformal prediction bands for survival probabilities at specified time points
using right-tailed and left-tailed p-values. Optionally applies a doubly robust correction
that clips the band using the fitted survival model's predictions.
}
\details{
This function implements the conformal survival band (CSB) construction method described in the associated paper.
For each time point, it computes one-sided conformal p-values and applies Benjamini-Hochberg (BH) adjustment
to construct valid marginal prediction intervals. If \code{doubly_robust = TRUE}, the lower and upper bounds
are clipped to ensure they lie within the model-predicted curve, improving practical performance.
}
